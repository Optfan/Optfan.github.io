import{K as I,l as s,i as N,r as n,s as A,L as B,o as i,a as d,w as y,E as b,e as v,k as x,u as C,f as T,F as R,Q as U,g as V,N as j,J as z,M}from"./index-DfBtx3oA.js";import{b as O}from"./legacy-BYlQRfW3.js";import{a as S,_ as D}from"./axios-WvFoFazB.js";import{_ as F,a as q}from"./Skeleton-D4hzFEUC.js";import{h as G}from"./pixiv-DUoKjwdV.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./light-C2B3ab-m.js";import"./fade-in.cssr-pLevcU0q.js";const J=["src"],K={__name:"ArtworksImage",props:{pid:Number},setup($){I(t=>({"189e198f":s(c)}));const l=N("$pixiv_proxy_baseUrl"),u=n(!0),p=n(0),g=n(),r=n(!1),c=n("0"),k=$,o=n(null),f=async t=>{try{return await S.head(`${l}/${t}-2.png`),`${l}/${t}-1.png`}catch{return`${l}/${t}.png`}},w=async t=>new Promise(async(_,m)=>{const a=new XMLHttpRequest;a.open("GET",await f(t),!0),a.responseType="blob",a.onload=function(){if(this.status==200){const h=this.response;h.size/1048576;const E=URL.createObjectURL(h);let L=new Image;L.onload=function(){L=null},p.value=100,_(E)}else m()},a.addEventListener("progress",h=>{p.value=h.loaded/5242880*100}),a.send()}),e=new IntersectionObserver(t=>{t.forEach(_=>{_.isIntersecting&&(w(k.pid).then(m=>{o.value=m,r.value=!0,setTimeout(()=>{c.value="1",u.value=!1},100)}),e.disconnect())})});return A(()=>{e.observe(g.value)}),B(()=>{e.disconnect()}),(t,_)=>{const m=F,a=q;return i(),d("div",{class:"img-container",ref_key:"container",ref:g},[y(v("img",{src:s(o),class:"img"},null,8,J),[[b,s(r)]]),y(x(m,{class:"skeleton",height:"100%",width:"100%",sharp:!1},null,512),[[b,s(u)]]),y(x(a,{class:"progress",type:"line",percentage:s(p),"show-indicator":!1,"border-radius":0,color:"rgba(0, 0, 0, 0.5)"},null,8,["percentage"]),[[b,s(u)]])],512)}}},P={class:"artworks-container"},Q=["onClick"],X={class:"id-text",style:{}},W={__name:"Artworks",setup($){const l=C(),u=T(),{id:p}=l.params,g=p.map(o=>O.decode(o)),r=n(!1),c=n(null),k=async o=>{r.value=!0,c.value=o;const f=await G(o);u.push({name:"artwork-id-total",params:{id:o,total:f}})};return(o,f)=>{const w=D;return i(),d("div",P,[(i(!0),d(R,null,U(s(g),e=>(i(),d("div",{class:"artworks",onClick:t=>k(e)},[v("div",{class:"img-c",style:z({position:"relative",opacity:s(r)&&e==s(c)?"0.5":"1"})},[x(K,{pid:e},null,8,["pid"]),s(r)&&e==s(c)?(i(),V(w,{key:0,style:{position:"absolute",top:"-20px",left:"-20px","margin-left":"50%","margin-top":"50%"},size:"large"})):j("",!0)],4),v("div",X,M(e),1)],8,Q))),256)),(i(),d(R,null,U(6,e=>v("div",{class:"artworks",style:{height:"0"},key:e})),64))])}}},ce=H(W,[["__scopeId","data-v-6eac1638"]]);export{ce as default};
