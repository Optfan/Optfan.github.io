import{K as U,l as e,i as E,r as n,s as I,L as N,o as m,a as f,w,E as y,e as b,k as x,u as A,f as B,F as C,Q as T,g as V,N as j,J as z,M}from"./index-BQjGC6y1.js";import{b as O}from"./legacy-BYlQRfW3.js";import{a as S,h as D,_ as F}from"./pixiv-CLdFCOwS.js";import{_ as q,a as G}from"./Skeleton-Dgiaun5w.js";import{_ as H}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./_commonjsHelpers-Cpj98o6Y.js";import"./light-DOfPr6ny.js";import"./fade-in.cssr-D_pQPUMc.js";import"./use-compitable-CVxFK2KE.js";const J=["src"],K={__name:"ArtworksImage",props:{pid:Number},setup($){U(s=>({"9583fe14":e(c)}));const i=E("$pixiv_proxy_baseUrl"),l=n(!0),p=n(0),d=n(),r=n(!1),c=n("0"),v=$,t=n(null),g=async s=>{try{return await S.head(`${i}/${s}-2.png`),`${i}/${s}-1.png`}catch{return`${i}/${s}.png`}},k=async s=>new Promise(async(u,_)=>{const a=new XMLHttpRequest;a.open("GET",await g(s),!0),a.responseType="blob",a.onload=function(){if(this.status==200){const h=this.response;h.size/1048576;const R=URL.createObjectURL(h);let L=new Image;L.onload=function(){L=null},p.value=100,u(R)}else _()},a.addEventListener("progress",h=>{p.value=h.loaded/5242880*100}),a.send()}),o=new IntersectionObserver(s=>{s.forEach(u=>{u.isIntersecting&&(k(v.pid).then(_=>{t.value=_,r.value=!0,setTimeout(()=>{c.value="1",l.value=!1},100)}),o.disconnect())})});return I(()=>{o.observe(d.value)}),N(()=>{o.disconnect()}),(s,u)=>{const _=q,a=G;return m(),f("div",{class:"img-container",ref_key:"container",ref:d},[w(b("img",{src:e(t),class:"img"},null,8,J),[[y,e(r)]]),w(x(_,{class:"skeleton",height:"100%",width:"100%",sharp:!1},null,512),[[y,e(l)]]),w(x(a,{class:"progress",type:"line",percentage:e(p),"show-indicator":!1,"border-radius":0,color:"rgba(0, 0, 0, 0.5)"},null,8,["percentage"]),[[y,e(l)]])],512)}}},P={class:"artworks-container"},Q=["onClick"],X={class:"id-text",style:{}},W={__name:"Artworks",setup($){const i=A(),l=B(),{id:p}=i.params,d=p.map(t=>O.decode(t)),r=n(!1),c=n(null),v=async t=>{r.value=!0,c.value=t;const g=await D(t);l.push({name:"artwork-id-total",params:{id:t,total:g}})};return(t,g)=>{const k=F;return m(),f("div",P,[(m(!0),f(C,null,T(e(d),o=>(m(),f("div",{class:"artworks",onClick:s=>v(o)},[b("div",{style:z({height:"90%",position:"relative",opacity:e(r)&&o==e(c)?"0.5":"1"})},[x(K,{pid:o},null,8,["pid"]),e(r)&&o==e(c)?(m(),V(k,{key:0,style:{position:"absolute",top:"-20px",left:"-20px","margin-left":"50%","margin-top":"50%"},size:"large"})):j("",!0)],4),b("div",X,M(o),1)],8,Q))),256))])}}},ce=H(W,[["__scopeId","data-v-15301117"]]);export{ce as default};
